<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>试题信息</title>
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/select.css" rel="stylesheet" type="text/css" />
    <link href="../js/validateform/validate.css" rel="stylesheet" />
    <link href="../plugin/kindeditor-4.1.7/themes/default/default.css" rel="stylesheet" />
    <style type="text/css">
        body {
            width: 640px;
            margin: 0 auto;
            padding: 0;
            min-width: 500px;
        }
    </style>
    <link href="../css/q.css" rel="stylesheet" />
    <script type="text/javascript" src="/js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="/js/select-ui.min.js"></script>
    <script src="/js/lhgdialog/lhgdialog.js?skin=iblue" type="text/javascript"></script>
    <script src="/js/base.js" type="text/javascript"></script>
    <script src="../js/validateform/Validform_v5.3.2_min.js" type="text/javascript"></script>
    <script src="../js/jquery.ztree.core-3.5.min.js" type="text/javascript"></script>
    <script src="../plugin/kindeditor-4.1.7/kindeditor-min.js" type="text/javascript"></script>
</head>
<body>
    <div style="min-width:500px;margin:10px auto;">
        <ul class="forminfo">
            <li id="liQtype">
                <label>题型(一题多问):</label>
                <table id="RbtQtype">
                    <tbody>
                        <tr>
                            <td><input type="radio" value="单选" name="RbtQtype" id="RbtQtype_0"><label for="RbtQtype_0">单选</label></td>
                            <td><input type="radio" value="多选" name="RbtQtype" id="RbtQtype_1"><label for="RbtQtype_1">多选</label></td>
                            <td><input type="radio" value="简答" name="RbtQtype" id="RbtQtype_2"><label for="RbtQtype_2">简答</label></td>
                            <td><input type="radio" value="判断" name="RbtQtype" id="RbtQtype_3"><label for="RbtQtype_3">判断</label></td>
                        </tr>
                    </tbody>
                </table>
            </li>
            <li><label>题  目：<b>*</b></label>
              <textarea class="textinput editor" id="txtSubject" ></textarea>
            </li>
            <li>
                <label>选  项</label>
                <table id="table-items" cellpadding="0" cellspacing="0">
                    <thead>
                        <tr>
                            <th>&nbsp;&nbsp;选项</th>
                            <th width="80px">操作</th>
                        </tr>
                    </thead>
                    <tr>
                        <td><textarea rows="4" cols="100">A、</textarea></td>
                        <td><a href="javascript:void(0);" class="btnRemove">移除</a></td>
                    </tr>
                    <tr>
                        <td align="center" colspan="2">
                            <img src="/images/t01.png" alt="添加" id="btnAddOption" title="点击，添加新的选择项！" />
                        </td>
                    </tr>
                </table>
            </li>
            <li><label>答  案：<b>*</b></label><textarea class="textinput editor" id="txtAnswer" runat="server"></textarea></li>
            <li><label>排  序：</label><input id="txtSort" type="text" class="input dfinput" value="999" errormsg="排序数字必须是大于等于0的整数" datatype="n" maxlength="9" /></li>
            <li><label>分  值：</label><input id="txtScore" type="text" class="input dfinput" value="1" maxlength="2" /></li>
            <li>
                <label>状  态：</label>
                <table id="RbtState">
                    <tbody>
                        <tr>
                            <td><input type="radio" checked="checked" value="1" name="RbtState" id="RbtState_0"><label for="RbtState_0">启用</label></td>
                            <td><input type="radio" value="0" name="RbtState" id="RbtState_1"><label for="RbtState_1">禁用</label></td>
                        </tr>
                    </tbody>
                </table>
            </li>
            <li><label>解  析：</label><textarea class="textinput editor" id="txtAnalyze" runat="server"></textarea></li>
            <li style="text-align:center;"><input type="submit" value="保存信息" id="btnSubmit" class="btn" /></li>
        </ul>
    </div>
    <!--模板-->
    <div class="tpl-container">
        <table id="table-tpl-option">
            <tr>
                <td><textarea rows="4" cols="100"></textarea></td>
                <td width="80px"><a href="javascript:void(0);" class="btnRemove">移除</a></td>
            </tr>
        </table>
    </div>
    <script type="text/javascript">
        var editor;
        KindEditor.ready(function (K) {
            editor = K.create('textarea.editor', {
                resizeType: 1,
                resizeMode: 1,
                width:500,
                minWidth:500,
                allowPreviewEmoticons: false,
                allowImageUpload: false,
                items: [
                    'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
                    'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                    'insertunorderedlist', '|', 'emoticons', 'image', 'link']
            });
          
        });
        $(document.body).ready(function ()
        {
            //初始化
            init();
            $("#btnAddOption").bind("click", function () {addItem(this);});
            //移除选项
            $(".btnRemove").bind("click", function () {$(this).parent().parent().remove();});
            //保存信息
            $("#btnSubmit").bind("click", function ()
            {
                //数据格式
                var _itemsArray = [];//选项
                $("#table-items textarea").each(function (i, item) {_itemsArray.push($(item).val());});
                for (var j = 0; j < KindEditor.instances.length; j++){KindEditor.instances[j].sync();}
                //console.log($("#txtAnswer").val());
                var data = {
                    question:$("#txtSubject").val(),
                    items: _itemsArray,
                    answer: $("#txtAnswer").val(),
                    level: "",
                    score: $("#txtScore").val(),
                    state: $("input[name='RbtState']").val(),
                    qtype: { "id": "1", "names": "单选题" },
                    analyze: $("#txtAnalyze").val(),
                    sort:$("#txtSort").val()
                };
                //修改
                if (__Tiku.queryString("action") == "edit")
                {
                    window.parent.q.SaveModify(data, function (current)
                    {
                        current = null;
                        //关闭窗口
                        window.parent.q.CloseWin();
                    });
                    return;
                }
                //添加：传递数据到父窗口
                window.parent.q.AddQ(data, function () {window.parent.q.CloseWin();});
              
            });
        });
        //初始化页面数据
        function init()
        {
            var _qtype = $("#RbtQtype input[name='RbtQtype']:checked", window.parent.document).val();
            if (_qtype == "5") {$("#liQtype").show();}
            if (__Tiku.queryString("action") == "edit")
            {
                var _data = parent.q.Context;
                if (_data) {
                    $("#txtSubject").val(_data.question);
                    $("#txtAnswer").val(_data.answer);
                    $("#txtAnalyze").val(_data.analyze);
                    $("#txtScore").val(_data.score);
                    $("#txtSort").val(_data.sort);
                    var _target = $("#btnAddOption")[0];
                    $(_target).parent().parent().prev().remove();
                    for (var i in _data.items)
                    {
                        addItem(_target, _data.items[i]);
                    }
                }
            }
        }
        //添加选项
        function addItem(target,item)
        {
            //添加选项
            var _indexEN = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "K", "L"];
            if ($("#table-items tr").length > 9) { return; }
            var $newOption = $("#table-tpl-option tr").first().clone(true);
            if (item &&item.length>0){$newOption.find("textarea").val(item);}
            else
            {
                $newOption.find("textarea").val(_indexEN[$("#table-items tr").length - 2] + "、");
            }
            if ($(target).parent().parent().prev().length == 0)
            {
                $(target).parent().parent().before($newOption);
                return;
            }
            $(target).parent().parent().prev().after($newOption);
        }
    </script>
</body>
</html>
